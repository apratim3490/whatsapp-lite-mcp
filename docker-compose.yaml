services:
  whatsapp-bridge:
    build:
      context: .
      dockerfile: Dockerfile.bridge
    # No host port â€” bridge only reachable within whatsapp-net
    volumes:
      - ./store:/app/whatsapp-bridge/store
    environment:
      - TZ=UTC
      - DISABLE_AUTH_CHECK=true
    healthcheck:
      test: ["CMD", "wget", "-q", "--spider", "http://localhost:8080/api/health"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    networks:
      - whatsapp-net

  whatsapp-mcp:
    build:
      context: .
      dockerfile: Dockerfile.mcp
    ports:
      - "127.0.0.1:8081:8081"  # MCP SSE transport
    environment:
      - TZ=UTC
      - BRIDGE_HOST=whatsapp-bridge
    depends_on:
      - whatsapp-bridge
    restart: unless-stopped
    networks:
      - whatsapp-net

networks:
  whatsapp-net:
    driver: bridge
