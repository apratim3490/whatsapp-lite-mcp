# Dockerfile for WhatsApp MCP Server (send-only)
FROM python:3.13-slim

WORKDIR /app

COPY ./whatsapp-mcp-server /app/whatsapp-mcp-server

# Create non-root user
ARG UID=1000
ARG GID=1000
RUN groupadd -g ${GID} appuser && useradd -l -u ${UID} -g appuser appuser

# Install Python dependencies
WORKDIR /app/whatsapp-mcp-server
RUN pip install --no-cache-dir -r requirements.txt

# Create entrypoint
RUN printf '#!/bin/bash\ncd /app/whatsapp-mcp-server\npython main.py\n' > /app/entrypoint-mcp.sh \
    && chmod +x /app/entrypoint-mcp.sh \
    && chown -R appuser:appuser /app

USER appuser

EXPOSE 8081

ENTRYPOINT ["/app/entrypoint-mcp.sh"]
